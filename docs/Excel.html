<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>R und Excel</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Codesammlung</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Excel.html">Excel</a>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">R und Excel</h1>

</div>


<p>Immer wieder kommt es vor, dass Daten für andere Nutzer in Excel
exportiert werden müssen. Mit dem Package openxlsx lassen sich die Daten
nicht nur abspeichern, sie können auch beliebig formatiert werden. Somit
eignet sich das Package perfekt zur automatisierten Erstellung von
Exceldateien. Wer viele Excelsheets generieren möchte, kann das z.B. mit
Hilfe von Schleifen umsetzen.</p>
<p>Auch das Auslesen von Exceldateien ist mit openxlsx sehr komfortabel
möglich. Hierbei können sowohl ganze Excelsheets als auch Teile daraus
aufgerufen werden.</p>
<div id="workbook-anlegen" class="section level2">
<h2>Workbook anlegen</h2>
<p>Als erstes muss immer ein leeres Workbook angelegt werden.</p>
<pre class="r"><code>library(openxlsx)

# Workbook erstellen
wb &lt;- createWorkbook()</code></pre>
</div>
<div id="worksheet-erstellen" class="section level2">
<h2>Worksheet erstellen</h2>
<p>Für das neu angelegte Workbook wird nun ein Sheet generiert:</p>
<pre class="r"><code># Excelsheet anlegen und benennen
addWorksheet(wb, &quot;Daten&quot;)</code></pre>
</div>
<div id="worksheet-befüllen" class="section level2">
<h2>Worksheet befüllen</h2>
<p>In ein definiertes Sheet können nun mit writeData() Daten geschrieben
werden. Die Formatierung kann mit dem Befehl createStyle() definiert und
anschließend mit addStyle() angewendet werden. Hierbei lassen sich
verschiedene Styles definieren und auf die gespeicherten Daten bzw. auch
beliebige Zellen im Excelsheet anwenden.</p>
<pre class="r"><code>#Styles definieren
header_style &lt;- createStyle(halign = &quot;center&quot;, textDecoration = &quot;bold&quot;, border = &quot;Bottom&quot;)

style_grau &lt;- createStyle(fgFill = &quot;#d6d6d6&quot;, fontColour = &quot;#313c48&quot;)

# Daten in Sheet schreiben, headerStyle kann mit definiert werden
writeData(wb, &quot;Daten&quot;, iris, headerStyle = header_style)

# Formatierung bestimmter Zellen:
addStyle(wb, &quot;Daten&quot;, rows = 2:(nrow(iris)+1), cols = 2, style = style_grau)</code></pre>
</div>
<div id="spaltenbreite" class="section level2">
<h2>Spaltenbreite</h2>
<p>Die Spaltenbreite kann automatisch angepasst oder anhand eines
Vektors individuell festgelegt werden.</p>
<pre class="r"><code># Spaltenbreite automatisch anpassen
setColWidths(wb, sheet = &quot;Daten&quot;, cols = 1:ncol(iris), widths = &quot;auto&quot;)

# Spaltenbreite individuel verändern
setColWidths(wb, sheet = &quot;Daten&quot;, cols = 1:ncol(iris),  widths = c(16, 15, 12, 33))

# Zeilenhöhe anpassen
setRowHeights(wb, sheet = &quot;Daten&quot;, rows = 1:nrow(iris),  heights = rep(30, times = nrow(iris)))</code></pre>
</div>
<div id="bedingte-formatierung" class="section level2">
<h2>Bedingte Formatierung</h2>
<pre class="r"><code>#Daten mit Wert größer gleich 3 rot einfärben
style_rot &lt;- createStyle(fontColour = &quot;#ff5232&quot;)

conditionalFormatting(wb, &quot;Daten&quot;, cols = 1:3, rows = 2:nrow(iris), rule = &quot;A2&gt;=3&quot;, style = style_rot)</code></pre>
</div>
<div id="datenüberprüfung" class="section level2">
<h2>Datenüberprüfung</h2>
<p>Wir können festlegen welche Werte in eine Spalte eingegeben werden
dürfen. Entspricht die Eingabe nicht der Vorgabe, entsteht eine
Fehlermeldung in Excel.</p>
<pre class="r"><code># Neues Sheet
addWorksheet(wb, &quot;Datenüberprüfung&quot;)

#Überprüfung auf Wert
writeData(wb, &quot;Datenüberprüfung&quot;, x = &quot;Zahl zwischen 1 und 5 eingeben&quot;, startCol = 1, startRow = 2)

dataValidation(wb, &quot;Datenüberprüfung&quot;, cols = 2, rows = 2, type = &quot;whole&quot;, operator = &quot;between&quot;, value = c(1, 5)
) 
#Überprüfung auf Datum
writeData(wb, &quot;Datenüberprüfung&quot;, x = &quot;Datum eingeben&quot;, startCol = 1, startRow = 4)

dataValidation(wb, &quot;Datenüberprüfung&quot;, cols = 2, rows = 4, type = &quot;date&quot;, operator = &quot;greaterThanOrEqual&quot;, value = as.Date(&quot;2022-01-01&quot;)
)  

#Um Auswahlfelder zu generieren  kann ebenfalls die Funktion dataValidation() verwendet werden.
addWorksheet(wb, &quot;Dropdown&quot;)

writeData(wb, &quot;Dropdown&quot;, x = c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;), startCol = 1, startRow = 1)

writeData(wb, &quot;Datenüberprüfung&quot;, x = &quot;Wert auswählen&quot;, startCol = 1, startRow = 6)

dataValidation(wb, &quot;Datenüberprüfung&quot;, cols = 2, rows = 6, type = &quot;list&quot;, value = &quot;&#39;Dropdown&#39;!$A$1:$A$3&quot;)

# Feld das überprüft wird grau hervorheben
addStyle(wb, &quot;Datenüberprüfung&quot;, cols = c(2, 2, 2), rows = c(2, 4, 6), style = style_grau)

setColWidths(wb, sheet = &quot;Datenüberprüfung&quot;, cols = 1:2, widths = c(30, 12))</code></pre>
</div>
<div id="zeilen-spalten-fixieren" class="section level2">
<h2>Zeilen / Spalten fixieren</h2>
<pre class="r"><code>freezePane(wb, &quot;Daten&quot;, firstActiveRow = 2, firstActiveCol = 1)</code></pre>
</div>
<div id="blattschutz" class="section level2">
<h2>Blattschutz</h2>
<p>Um Zellen vom Blattschutz auszunehmen, kann bei der Erstellung des
Styles locked = FALSE gesetzt werden.</p>
<pre class="r"><code># Style definieren
style_grau_ungeschuetzt &lt;- createStyle(fgFill = &quot;#d6d6d6&quot;, fontColour = &quot;#313c48&quot;, locked = FALSE)

# Style auf veränderbare Zellen anwenden
addStyle(wb, &quot;Datenüberprüfung&quot;, cols = c(2,2,2), rows = c(2,4,6), style = style_grau_ungeschuetzt)

# Blatt schützen
protectWorksheet(wb, &quot;Datenüberprüfung&quot;, protect = TRUE)</code></pre>
</div>
<div id="workbook-speichern" class="section level2">
<h2>Workbook speichern</h2>
<p>Nachdem alles definiert und formatiert wurde, kann das Workbook als
Exceldatei abgespeichert werden.</p>
<pre class="r"><code># Workbook speichern:
saveWorkbook(wb, &quot;Test_Daten.xlsx&quot;, overwrite = T)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
